import { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, setDoc, doc, getDoc } from './firebase-config.js';

const signupForm = document.getElementById('signupForm');
const loginForm = document.getElementById('loginForm');
const toLogin = document.getElementById('toLogin');
const toSignup = document.getElementById('toSignup');

toLogin.onclick = () => {
  signupForm.style.display = 'none';
  loginForm.style.display = 'block';
};
toSignup.onclick = () => {
  loginForm.style.display = 'none';
  signupForm.style.display = 'block';
};

// SIGN UP
document.getElementById('signupBtn').addEventListener('click', async () => {
  const username = document.getElementById('signupName').value;
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Save to Firestore
    await setDoc(doc(db, "users", user.uid), {
      username: username,
      email: email,
      createdAt: new Date().toISOString()
    });

    localStorage.setItem('username', username);
    alert('Account created successfully!');
    window.location.href = 'dashboard.html';
  } catch (error) {
    alert(error.message);
  }
});

// SIGN IN
document.getElementById('loginBtn').addEventListener('click', async () => {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Retrieve username
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const username = docSnap.data().username;
      localStorage.setItem('username', username);
    }

    alert('Login successful!');
    window.location.href = 'dashboard.html';
  } catch (error) {
    alert(error.message);
  }
});
